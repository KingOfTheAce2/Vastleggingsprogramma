<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Werkprogramma IB & VPB</title>
    <!-- Using Tailwind CSS for a clean, modern look -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Simple transition for showing/hiding questions */
        .question-container.hidden, .content-pane.hidden {
            display: none;
        }
        .sub-question {
            padding-left: 2rem; /* Indent sub-questions */
            border-left: 2px solid #e5e7eb; /* Add a visual indicator for nesting */
            margin-left: 0.5rem;
        }
        /* Style for the active program button */
        .program-btn.active {
            background-color: #2563eb;
            color: white;
            font-weight: 600;
        }
        /* Style for the active tab button */
        .tab-btn.active {
            border-color: #2563eb;
            color: #2563eb;
            font-weight: 600;
        }
        /* Custom styles for headings within the work program */
        .werkprogramma-heading {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            padding-bottom: 0.25rem;
            border-bottom: 2px solid #d1d5db;
        }
    </style>
</head>
<body class="bg-gray-100 font-sans">

    <div class="container mx-auto p-4 md:p-8">
        <header class="bg-white p-6 rounded-lg shadow-md mb-8">
            <h1 class="text-3xl font-bold text-gray-800">Dynamisch Werkprogramma</h1>
            <p class="text-gray-600 mt-2">Selecteer een werkprogramma om te beginnen.</p>
            
            <!-- Buttons to switch between IB and VPB programs -->
            <div class="mt-4 flex space-x-4">
                <button id="btn-ib" class="program-btn flex-1 py-2 px-4 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition">
                    Inkomstenbelasting (IB)
                </button>
                <button id="btn-vpb" class="program-btn flex-1 py-2 px-4 rounded-md bg-gray-200 text-gray-700 hover:bg-gray-300 transition">
                    Vennootschapsbelasting (VPB)
                </button>
            </div>
        </header>

        <main id="werkprogramma-container" class="bg-white p-6 rounded-lg shadow-md min-h-[200px]">
            <div id="welcome-message" class="text-center p-8">
                <h2 class="text-xl font-semibold text-gray-700">Welkom!</h2>
                <p class="text-gray-500 mt-2">Kies hierboven een werkprogramma om de vragenlijst te laden.</p>
            </div>
            <div id="loader" class="text-center p-8 hidden">
                <p class="text-gray-500">Werkprogramma wordt geladen...</p>
            </div>
            <!-- Tabs and question content will be dynamically inserted here -->
        </main>

        <footer class="text-center mt-8 text-gray-500">
            <p>&copy; 2024 MVP Werkprogramma</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const btnIb = document.getElementById('btn-ib');
            const btnVpb = document.getElementById('btn-vpb');

            // Event listeners for the program selection buttons
            btnIb.addEventListener('click', () => {
                setActiveButton(btnIb, '.program-btn');
                loadAndRenderWorkProgram('ib');
            });

            btnVpb.addEventListener('click', () => {
                setActiveButton(btnVpb, '.program-btn');
                loadAndRenderWorkProgram('vpb');
            });
        });
        
        // Data store for all markdown content
        const CONTENT_DATA = {
            client: `
## Klant acceptatie
1. Is de opdrachtbevestiging getekend en opgeslagen in het dossier?
2. Is er een kopie van het paspoort of identiteitsbewijs van de cliënt aanwezig?
3. Is de UBO (Ultimate Beneficial Owner) vastgesteld en gedocumenteerd?
    a. Zijn de UBO-verklaringen compleet en ondertekend?
4. Is het KYC (Know Your Customer) proces volledig doorlopen?
    a. Is de cliënt gecontroleerd op PEP (Politically Exposed Person) en sanctielijsten?
    b. Is de uitkomst van de Wwft-check vastgelegd?
`,
            ib: `
## Algemeen
1. Is cliënt het hele jaar of een gedeelte van het jaar gehuwd? Zo nee, ga naar vraag 6
2. Is cliënt gehuwd in gemeenschap van goederen?
3. Onder huwelijkse voorwaarden (kopie in permanent dossier)?
4. Is cliënt dit jaar gehuwd? Zo ja per welke datum?
5. a. Is cliënt dit jaar gescheiden?
   b. Zo ja, is een verzoek tot echtscheiding/scheiding tafel en bed ingediend?
   c. Zo ja, is cliënt niet meer woonachtig op hetzelfde woonadres in het bevolkingsregister?
6. Is cliënt ongehuwd samenwonend? Zo nee: ga naar vraag 12
7. Is er een notarieel samenlevingscontract (kopie in permanent dossier)?
8. Staat cliënt en partner op hetzelfde woonadres in het bevolkingsregister? Hele jaar?
9. Is cliënt dit jaar gaan samenwonen? Vanaf wanneer?
10. Is cliënt dit jaar uit elkaar gegaan? Vanaf wanneer?
11. Hebben cliënt en partner samen kind of een kind erkend van de ander?
12. Staat de partner van de cliënt als partner in diens pensioenregeling?
13. Hebben cliënt en partner samen een eigen woning?
14. Zijn gegevens kinderen ingevuld (geb. datum, bsn, voorletters) in FiscaalGemak?
    a. Is aangegeven of sprake is van een thuiswonend kind (onderdeel heffingskortingen)?
    b. Bij co-ouderschap: is beoordeeld of de inkomensafhankelijke combinatiekorting kan worden geclaimd bij de ouder waar het kind niet staat ingeschreven?
15. Heeft cliënt een testament opgemaakt (kopie in permanent dossier)?
## Verliesverrekening
16. Is er sprake van verlies in voorgaande jaren? Zo nee, ga naar vraag 18
17. Zijn de verliezen van voorgaande jaren goed ingevuld conform de verliesbeschikkingen en zijn de definitieve aanslagen in het dossier opgenomen?
18. Is er dit jaar sprake van een verlies? Zo nee, ga naar vraag 20
19. Is het belastbaar inkomen uit het verleden goed ingevuld conform de definitieve aanslagen?
20. Nog te verrekenen persoonsgebonden aftrek voorgaande jaren? Zo ja, ingevuld in aangifte?
## Box I aandachtspunten
21. Is er sprake van winst uit onderneming? Zo nee, ga naar vraag 22
    a. Jaarstukken
       - Zijn alle jaarstukken ingevoerd?
       - Btw-positie gespecificeerd in jaarstuk?
       - Sluit het resultaat van het jaarstuk met de aangifte in aangifteprogramma?
       - Is de jaarrekening al door vennoot/afdelingshoofd nagekeken?
    b. Aangifte
       - Voldoet cliënt aan urencriterium en licht toe waarom?
       - Is de landbouwvrijstelling toegepast? Zo ja, licht toe
       - Uitgesloten of beperkt aftrekbare kosten ingevuld?
       - Willekeurige afschrijving van toepassing? Zo ja, licht toe
       - Afschrijving gebouwen/bodemwaarde ingevuld?
       - Kleinschaligheidsinvesteringsaftrek van toepassing?
       - Milieu- of Energieinvesteringsaftrek van toepassing?
       - Desinvesteringsbijtelling van toepassing?
       - Zelfstandigenaftrek van toepassing?
       - Startersaftrek van toepassing? Zo ja, licht toe hoeveel jaar nog
       - Startersaftrek arbeidsongeschiktheid van toepassing?
       - Aftrek S&O van toepassing?
       - Meewerkaftrek of meewerkbeloning mogelijk? Zo ja, licht toe
       - In geval van staking: is de stakingswinst goed onderbouwd en aangegeven?
       - Stakingsaftrek toegepast? Licht toe
       - FOR op balans? Let op hoogte ondernemingsvermogen
       - (Inhaal)dotatie FOR toegepast? Zo nee, licht toe
       - Vrijval FOR (verplicht of vrijwillig)? Licht toe
       - Privégebruik auto goed verwerkt in aangifteprogramma
       - Is werkruimte een zelfstandig deel van de woning? Licht toe
       - Wordt er een HIR gevormd of benut? Zo nee, ga naar vraag 22
       - HIR gevormd: ligt het vervangingsvoornemen goed vast in het dossier?
       - HIR benut: is deze goed verwerkt in aangifteprogramma?
       - Is rekening gehouden met boekwaarde-eis/willekeurige afschrijving verleden?
22. Is er sprake van loon of inkomen uit vroegere dienstbetrekking? Zo nee, ga naar vraag 23
    - Jaaropgaven in dossier?
    - Als werknemer met openbaar vervoer reist: verklaring in dossier?
    - Is er sprake van een dga? Zo nee, ga naar vraag 23
    - Is de gebruikelijkloonregeling van toepassing?
    - Is de hoogte van het gebruikelijk loon nog te beoordelen?
23. Is er sprake van resultaat uit overige werkzaamheden? Zo nee, ga naar vraag 24
    - Jaaropgaven in dossier
    - Balans/resultaat per werkzaamheid ingevuld
    - Is werkruimte een zelfstandig deel van de woning? Licht toe
    - Dga: is rekening-courant gedurende het jaar maximaal €17.500?
    - Is sprake van een vordering op de bv? Zakelijke leningovereenkomst aanwezig?
    - Is er sprake van een tbs-pand? Zo nee, ga naar vraag 24
        a. Is de huur zakelijk? Licht toe
        b. Huurovereenkomst aanwezig in permanent dossier?
        c. Rekening gehouden met kostenaftrek (hypotheekrente e.d.)?
        d. Afschrijvingen beoordeeld (bodemwaarde en afschrijvingsbeperking)?
        e. Schulden toegerekend aan het pand?
        f. Voorziening voor groot onderhoud noodzakelijk?
24. Is er sprake van (negatieve) uitgaven inkomensvoorziening? Zo nee, ga naar vraag 25
    A. Lijfrente
       - Jaar- en reserveringsruimte ingevuld?
       - Lijfrentepolis in permanent dossier?
       - Lijfrente niet aftrekbaar: afname FOR mogelijk?
       - Stakingslijfrente aanwezig?
    B. Premies arbeidsongeschiktheidsverzekering betaald?
       - Betalingsbewijs in dossier?
       - Polis aov in permanent dossier?
    C. Terugontvangen premies? Licht toe
25. Inkomsten uit eigen woning
    - Is er een eigenwoningreserve uit het verleden?
    - Is er een aflossingsstand? Licht toe
    - Is er sprake van een eigen woning? Zo nee, ga naar vraag 26
    - WOZ-beschikking in dossier?
    - Is sprake van een oude lening (niet verplicht annuïtair)?
    - Is sprake van een nieuwe lening (verplicht annuïtair)?
    - Overzicht betaalde hypotheekrente in dossier?
    - Vrijgestelde schenking voor de eigen woning ontvangen? Licht toe
    - Eigen woning verkocht of gekocht dit jaar? Licht toe
    - Staat eigen woning leeg te koop of in aanbouw? Licht toe
    - Hypotheek dit jaar verhoogd? Onderbouwing in dossier?
    - Overzicht looptijd renteaftrek leningen bijgewerkt?
    - Kapitaalverzekering eigen woning? Polis in permanent dossier?
    - Bijleenregeling van toepassing en ingevuld?
    - Is er sprake van een ondernemer of resultaatgenieter?
    - Geen zelfstandige werkruimte: 100% WOZ toegepast?
26. Is er sprake van periodieke uitkeringen en verstrekkingen? Zo nee, ga naar vraag 27
    - Alimentatie ontvangen? (voor kinderen niet belast)
    - Echtscheidingsconvenant aanwezig in permanent dossier?
    - Overige periodieke uitkeringen die niet onder de loonheffing vallen?
## Box II aandachtspunten
27. Is er sprake van een aanmerkelijk belang? Zo nee, ga naar vraag 28
    - Aantal aandelen ingevuld in aangifteprogramma?
    - Verkrijgingsprijs aanmerkelijk belang ingevuld?
    a. Regulier voordeel? Zo ja:
       - Aangifte(n) dividendbelasting in dossier?
       - Rente betaald voor aankoop AB-aandelen? Onderbouwing aanwezig?
       - Andere winstuitkeringen of forfaitair rendement buitenlandse beleggingsinstelling?
    b. (Fictief) vervreemdingsvoordeel? Zo ja:
       - Verkoopovereenkomst in permanent dossier?
       - Akte van levering in permanent dossier?
       - Kosten in mindering op overdrachtsprijs gebracht?
## Box III aandachtspunten
28. Is er sprake van bezittingen? Zo nee, ga naar vraag 29
    a. Jaaropgave(n) banksaldi in dossier?
    b. Jaaropgave(n) effecten in dossier?
       - Nederlandse dividendbelasting ingevuld?
    c. Woningen (geen eigen woning) WOZ-waarde of WEV?
       - Verhuur of pacht? Leegwaarderatio toegepast?
    d. Overige onroerende zaken: WEV. Onderbouwing van waarde?
    e. Vrijgestelde kapitaalverzekering (niet eigen woning)? Polis in dossier?
    f. Kapitaalverzekering boven vrijstelling?
       - Polis in dossier?
       - Belaste waarde ingevuld?
       - Onderbouwing/jaaropgave in dossier?
    g. Vorderingen of verstrekte leningen? Specificatie aanwezig?
    h. Contant geld of cryptovaluta aanwezig?
    i. Overige relevante bezittingen (bijv. VvE-aandeel)?
    j. Aandeel onverdeelde boedel aanwezig? Berekening in dossier?
    k. Vruchtgebruik/bloot eigendom van toepassing? Berekening in dossier?
    l. Vermogen in het buitenland?
29. Is er sprake van schulden? Zo nee, ga naar vraag 30
    - Jaaropgave(n) banksaldi in dossier
    - Specificatie rekening-courant directie in dossier
    - Jaaropgave(n) overige schulden in dossier
30. Vrijstellingen
    - Gedefiscaliseerd: verkrijgingen krachtens erfrecht
    - Vrijstelling groene beleggingen van toepassing? Jaaropgave in dossier?
    - Heffingskorting groenbeleggingen ingevuld?
## Vermogen
31. Is het vermogen sterk toe- of afgenomen? Zo ja, verklaring in dossier aanwezig?
## Persoonsgebonden aftrek
32. Alimentatie betaald aan ex-partner?
    - Betalingsbewijzen en echtscheidingsconvenant in dossier?
    - Specifieke zorgkosten ingevuld? Onderbouwing in dossier?
    - Weekenduitgaven gehandicapten > 21 jaar van toepassing? Licht toe
    - Scholingsuitgaven van toepassing? Vastlegging in dossier (tot 2022)
    - Periodieke gift? Stukken in dossier
    - Reguliere giften? Betalingsbewijzen en ANBI/SBBI controle
## Heffingskortingen
33. Levensloop (deels) opgenomen? Levensloopkorting toegepast? (tot 2022)
    - Alleenstaande ouderenkorting bij AOW ongehuwden geclaimd?
    - Jonggehandicaptenkorting geclaimd indien van toepassing?
## Bijzondere situaties en voorheffingen
34. Betrokken bij trustvermogen?
    - Buitenlandse dividendbelasting ingevuld bij voorkoming dubbele belasting?
    - Buitenlands inkomen? Voorkoming dubbele belasting?
    - Inkomen waarover revisierente verschuldigd is?
    - Bezittingen in het buitenland? Voorkoming dubbele belasting?
    - Geen aanmerkelijk belang meer? Verlies uit AB verrekend of belastingkorting verzocht?
## Diversen
35. Heeft overheveling van box III naar box I of II plaatsgevonden of andersom? Licht toe
    - Voorlopige aanslagen IB/ZVW ingevuld?
    - Dienen voorlopige aanslagen verhoogd of verlaagd te worden?
    - Is middeling mogelijk?
    - Recht op zorgtoeslag, huurtoeslag of kindgebonden budget? Actie noodzakelijk?
    - Is de verdeling fiscaal optimaal? (Laatste stap vóór review)
    - Is de aangifte gevalideerd?
`,
            vpb: `
## Fiscale eenheid Vpb
| 1 | Is er sprake van een fiscale eenheid Vpb? Zo ja, onderstaande vragen beantwoorden |
| 2 | Zijn er ondernemingen gevoegd of ontvoegd in het boekjaar? |
| 3 | Hebben er verschuivingen plaatsgevonden binnen de fiscale eenheid van vermogensbestanddelen of HIR? Denk bijv. aan: onderneming (doorzakking), onroerend goed, machines/inventaris. Zo ja, licht toe |
## Concern
| 4 | Is er sprake van een concern (meerdere bv's)? Zo ja, onderstaande vragen beantwoorden |
| 5 | Vinden er transacties plaats binnen het concern/tussen gelieerde personen maar buiten de fiscale eenheid Vpb?<br>Zo ja, zijn deze transacties op zakelijke gronden en marktprijzen? |
| 6 | Is er sprake van (een) concernfinanciering(en) buiten fiscale eenheid Vpb?<br>- Is er sprake van een marktconforme rente?<br>- Zijn er voldoende zekerheden verstrekt?<br>- Zijn de overeenkomsten aanwezig in permanent dossier? |
## Aandeelhouders en deelnemingen
| 7 | Heeft de onderneming aandeelhouders? Zo ja, is de specificatie ingevuld (ook de schuld/vordering (R/C) posities en uitgekeerd dividend)? |
| 8 | Heeft de onderneming deelnemingen? Zo ja, is de specificatie ingevuld (ook de schuld/vordering (R/C) posities en uitgekeerd dividend)?<br>Indien sprake is van deelnemingen, is toepassing van de deelnemingsvrijstelling beoordeeld? |
## Jaarrekening(en)
| 9 | Is de afschrijvingsstaat in het dossier opgenomen? |
| 10 | Zijn de restwaarde en/of bodemwaarde ingevuld in de aangifte en beoordeeld? |
## Deelnemingen
| 16 | Zijn de deelnemingen fiscaal gewaardeerd op kostprijs in de aangifte? |
| 17 | Indien een deelneming vergroot/aangeschaft/verkleind/vervreemd is, zijn dan de kosten gecorrigeerd (niet aftrekbaar)? |
## Vorderingen
| 19 | Is de nominale waarde van de debiteuren/vorderingen opgenomen in de aangifte? |
| 20 | Is de rente op de leningen zakelijk (denk aan: zekerheid, marktconforme rente, aflossingscapaciteit)? |
## Passiva
| 21 | Sluit het fiscale beginvermogen in de aangifte aan met de aangifte van voorgaand jaar? |
## Fiscale voorzieningen
| 22 | Zo ja, is er een onderbouwing in het dossier en voldoen ze aan de fiscale eisen? |
| 23 | Onderhoudsvoorziening = onderhoudsplan aanwezig in permanent dossier? |
## Schulden
| 27 | Zit de rondrekening omzetbelasting in het dossier? Is de specificatie omzetbelasting in de aangifte ingevuld? |
| 28 | Is sprake van een lening? Zo ja, is de lening zakelijk (denk aan: zekerheid, marktconforme rente, aflossingscapaciteit)? |
## Vermogensvergelijking
| 29 | Zijn alle jaarstukken ingevoerd in het aangifteprogramma? |
| 30 | Is de jaarrekening al door partner/accountant nagekeken? |
## Fiscale winstberekening
| 34 | Zijn dividenduitkeringen, terugbetalingen van kapitaal aan aandeelhouders of kapitaalstortingen door aandeelhouders verwerkt? Zo ja, zijn de specificaties opgenomen in het dossier? |
| 35 | Is de balanspositie van de Vpb ingevuld in het aangifteprogramma (bij niet aftrekbare bedragen/Vpb)? |
## Verliesverrekening
| 42 | Is er sprake van verlies in voorgaande jaren? |
| 43 | Zijn de verliezen van voorgaande jaren goed ingevuld conform de verliesbeschikkingen |
## Algemeen/berekening belastingbedrag
| 47 | Als er sprake is van belegging in aandelen, is de Nederlandse dividendbelasting meegenomen in de voorheffingen en de buitenlandse bronheffing onder voorkoming dubbele belasting? |
| 48 | Zijn de voorlopige aanslagen opgenomen/beoordeeld in het aangifteprogramma? |
## Buitenlandse activiteiten
| 52 | Zijn er buitenlandse activiteiten (vaste inrichting)?<br>Is documentatie transfer pricing aanwezig? |
| 53 | Is er sprake van voorkoming dubbele belastingen (elders belast)? |
`
        };

        function setActiveButton(activeButton, selector) {
            document.querySelectorAll(selector).forEach(btn => btn.classList.remove('active'));
            activeButton.classList.add('active');
        }

        function parseMarkdownToList(markdown) {
            const lines = markdown.split('\n');
            const questions = [];
            let currentMainQuestion = null, currentSubQuestion = null;
            const mainQRegex = /^(\d+)\.\s*(.*)/, subQRegex = /^\s+([a-zA-Z])\.\s*(.*)/, detailQRegex = /^\s+-\s*(.*)/, headingRegex = /^##\s+(.*)/;

            lines.forEach(line => {
                let match;
                if ((match = line.match(headingRegex))) {
                    questions.push({ isHeading: true, text: match[1].trim() });
                    currentMainQuestion = null; currentSubQuestion = null;
                } else if ((match = line.match(mainQRegex))) {
                    const id = match[1];
                    let text = match[2].trim();
                    const condition = parseCondition(text);
                    if (condition) text = text.replace(/Zo nee,.*|Zo ja,.*/i, '').trim();
                    const question = { id, text, children: [], condition, level: 0 };
                    questions.push(question);
                    currentMainQuestion = question; currentSubQuestion = null;
                } else if (currentMainQuestion && (match = line.match(subQRegex))) {
                    const id = `${currentMainQuestion.id}${match[1]}`;
                    const question = { id, text: match[2].trim(), children: [], level: 1 };
                    currentMainQuestion.children.push(question);
                    currentSubQuestion = question;
                } else if ((currentSubQuestion || currentMainQuestion) && (match = line.match(detailQRegex))) {
                    const parent = currentSubQuestion || currentMainQuestion;
                    const id = `${parent.id}-${parent.children.length + 1}`;
                    parent.children.push({ id, text: match[1].trim(), level: (parent.level || 0) + 1, isDetail: true });
                }
            });
            return questions;
        }

        function parseMarkdownFromTable(markdown) {
            const lines = markdown.split('\n');
            const questions = [];
            const vpbQRegex = /^\|\s*(\d+)\s*\|([^|]+)\|/, headingRegex = /^##\s+(.*)/;
            lines.forEach(line => {
                let match;
                if ((match = line.match(headingRegex))) {
                    questions.push({ isHeading: true, text: match[1].trim() });
                } else if ((match = line.match(vpbQRegex))) {
                    questions.push({
                        id: match[1].trim(),
                        text: match[2].trim().replace(/<br>/g, ' '),
                        children: [], level: 0
                    });
                }
            });
            return questions;
        }

        function parseCondition(text) {
            const skipMatch = text.match(/Zo (nee|ja)[\s,:]*(?:ga naar vraag|ga naar)\s*(\d+)/i);
            if (skipMatch) return { on: skipMatch[1].toLowerCase(), action: 'skip', target: skipMatch[2] };
            if (/Zo nee, ga naar vraag \d+/.test(text)) return { on: 'no', action: 'hide_children' };
            return null;
        }

        function renderQuestions(questions, container, type) {
            questions.forEach(q => {
                container.appendChild(createQuestionElement(q, type));
                if (q.children && q.children.length > 0) {
                    const childrenContainer = document.createElement('div');
                    childrenContainer.id = `children-of-${q.id}`;
                    if (q.condition?.action === 'hide_children') childrenContainer.classList.add('hidden');
                    childrenContainer.classList.add('sub-question');
                    renderQuestions(q.children, childrenContainer, type);
                    container.appendChild(childrenContainer);
                }
            });
        }

        function createQuestionElement(q, type) {
            if (q.isHeading) {
                const heading = document.createElement('h2');
                heading.className = 'werkprogramma-heading';
                heading.textContent = q.text;
                return heading;
            }
            const div = document.createElement('div');
            div.className = 'question-container py-4 border-b border-gray-200';
            div.id = `question-${q.id}`;
            div.dataset.questionId = q.id;
            const questionText = document.createElement('p');
            questionText.className = 'font-semibold text-gray-700';
            questionText.textContent = q.isDetail ? q.text : `${q.id}. ${q.text}`;
            div.appendChild(questionText);
            if (!q.isDetail) {
                const radioContainer = document.createElement('div');
                radioContainer.className = 'mt-2 flex items-center gap-x-6';
                radioContainer.innerHTML = `
                    <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="answer-${q.id}" value="yes" class="form-radio h-4 w-4 text-blue-600"><span>Ja</span></label>
                    <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="answer-${q.id}" value="no" class="form-radio h-4 w-4 text-blue-600"><span>Nee</span></label>
                    <label class="flex items-center space-x-2 cursor-pointer"><input type="radio" name="answer-${q.id}" value="na" class="form-radio h-4 w-4 text-blue-600" checked><span>N.v.t.</span></label>
                `;
                if (type === 'ib' || type === 'client') {
                    radioContainer.addEventListener('change', (e) => handleAnswerChange(q, e.target.value));
                }
                div.appendChild(radioContainer);
            }
            return div;
        }
        
        function handleAnswerChange(question, answer) {
            const condition = question.condition;
            if (!condition) return;
            const shouldTrigger = (condition.on === answer);
            if (condition.action === 'skip') {
                const allQuestions = document.querySelectorAll('.question-container');
                const startSkipId = parseInt(question.id, 10) + 1;
                const endSkipId = parseInt(condition.target, 10);
                allQuestions.forEach(el => {
                    const currentId = parseInt(el.dataset.questionId, 10);
                    if (currentId >= startSkipId && currentId < endSkipId) {
                        el.classList.toggle('hidden', shouldTrigger);
                        const childrenEl = document.getElementById(`children-of-${el.dataset.questionId}`);
                        if(childrenEl) childrenEl.classList.toggle('hidden', shouldTrigger);
                    }
                });
            } else if (condition.action === 'hide_children') {
                const childrenContainer = document.getElementById(`children-of-${question.id}`);
                if (childrenContainer) childrenContainer.classList.toggle('hidden', shouldTrigger);
            }
        }

        async function loadAndRenderWorkProgram(type) {
            const container = document.getElementById('werkprogramma-container');
            const loader = document.getElementById('loader');
            const welcomeMsg = document.getElementById('welcome-message');
            
            welcomeMsg.classList.add('hidden');
            loader.classList.remove('hidden');
            container.innerHTML = '';
            container.appendChild(loader);

            try {
                await new Promise(resolve => setTimeout(resolve, 200));

                const clientQuestions = parseMarkdownToList(CONTENT_DATA.client);
                const taxQuestions = type === 'ib' ? parseMarkdownToList(CONTENT_DATA.ib) : parseMarkdownFromTable(CONTENT_DATA.vpb);
                
                loader.classList.add('hidden');
                
                // Create Tab structure
                container.innerHTML = `
                    <div class="border-b border-gray-200">
                        <nav class="-mb-px flex space-x-8" aria-label="Tabs">
                            <button id="tab-client" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Klant</button>
                            <button id="tab-tax" class="tab-btn whitespace-nowrap py-4 px-1 border-b-2 font-medium text-sm">Aangifte</button>
                        </nav>
                    </div>
                    <div id="client-pane" class="content-pane py-4"></div>
                    <div id="tax-pane" class="content-pane py-4 hidden"></div>
                `;

                const clientPane = document.getElementById('client-pane');
                const taxPane = document.getElementById('tax-pane');
                renderQuestions(clientQuestions, clientPane, 'client');
                renderQuestions(taxQuestions, taxPane, type);

                const tabClient = document.getElementById('tab-client');
                const tabTax = document.getElementById('tab-tax');
                
                // Tab switching logic
                const setupTabs = () => {
                    setActiveButton(tabClient, '.tab-btn');
                    tabClient.addEventListener('click', () => {
                        setActiveButton(tabClient, '.tab-btn');
                        clientPane.classList.remove('hidden');
                        taxPane.classList.add('hidden');
                    });
                    tabTax.addEventListener('click', () => {
                        setActiveButton(tabTax, '.tab-btn');
                        clientPane.classList.add('hidden');
                        taxPane.classList.remove('hidden');
                    });
                };
                setupTabs();

            } catch (error) {
                console.error(`Failed to load work program for ${type}:`, error);
                container.innerHTML = '<p class="text-red-500 text-center">Fout bij het laden van het werkprogramma.</p>';
            }
        }
    </script>
</body>
</html>
